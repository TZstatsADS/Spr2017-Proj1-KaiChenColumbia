library("tm")
library("syuzhet")
library("factoextra")
library("beeswarm")
library("scales")
library("RColorBrewer")
library("RANN")
library("tm")
library("topicmodels")
library("wordcloud")
library("tidytext")
library("RColorBrewer")
library("ggplot2")
library("scales")
source("../lib/plotstacked.R")
source("../lib/speechFuncs.R")
source("../lib/kai_source.R")
source("../lib/ggradar.R")
load("~/Desktop/333.RData")
#write out results
#docs to topics
ldaOut.topics <- as.matrix(topics(ldaOut))  # 每一句话都有了一个topic
table(c(1:k, ldaOut.topics))
write.csv(ldaOut.topics,file=paste("../out/LDAGibbs",k,"DocsToTopics.csv"))
#top 10 terms in each topic
ldaOut.terms <- as.matrix(terms(ldaOut,10))
write.csv(ldaOut.terms,file=paste("../out/LDAGibbs",k,"TopicsToTerms.csv"))
ldaOut.terms
#probabilities associated with each topic assignment
topicProbabilities <- as.data.frame(ldaOut@gamma)
write.csv(topicProbabilities,file=paste("../out/LDAGibbs",k,"TopicProbabilities.csv"))
names(topicProbabilities) <- c("World","Legislation","Government","Econ",
"Health","commonword","Industry","Security","Nation",
"Freedom","Politics","PublicAffair")
maxprob <- apply(topicProbabilities, 1, max)
max.matrix <- matrix(rep(maxprob, time = 10), ncol = 10)
## Using correlation to plot a heatmap to cluster K is not a good idea
heatmap.2(cor(topicProbabilities),
scale = "col",
col = bluered(100), margin=c(6, 6), key=F,
trace = "none", density.info = "none")
## We can compare the value of posterior probability of a term belonging a certain topic to our confidence towards certain topic, which will be helpful for later description.
par(mar=c(4, 6, 2, 1))
max.topic.probability <- apply(topicProbabilities, 1, max)
max.topic.names <- apply(topicProbabilities, 1, which.max)
confid <- data.frame(prob = max.topic.probability,
nametopic = names(topicProbabilities)[max.topic.names])
confid <- confid[sample(1:nrow(confid), 1000, replace = F), ]
beeswarm(prob ~ nametopic,
data=confid,
horizontal = TRUE,
pch=16, col=alpha(brewer.pal(9, "Set1"), 0.6),
cex=1, cex.axis=1, cex.lab=0.8,
spacing=5/nlevels(confid$nametopic),
las=2, ylab="", xlab="Number of words in a sentence.",
main="Inaugural Speeches")
## We can compare the value of posterior probability of a term belonging a certain topic to our confidence towards certain topic, which will be helpful for later description.
par(mar=c(4, 6, 2, 1))
max.topic.probability <- apply(topicProbabilities, 1, max)
max.topic.names <- apply(topicProbabilities, 1, which.max)
confid <- data.frame(prob = max.topic.probability,
## We can compare the value of posterior probability of a term belonging a certain topic to our confidence towards certain topic, which will be helpful for later description.
par(mar=c(4, 6, 2, 1))
max.topic.probability <- apply(topicProbabilities, 1, max)
Years.compare <- seq(2016, 1856, -4)
n.corpuss2 <- nrow(corpus.s.list) ## 19740
n.totalrow <- nrow(topicProbabilities) ## 62750
nrow(tdm)
corpuss.s.topic <- cbind(corpus.s.list, topicProbabilities[1:n.corpuss2,])
corpuss.p.topic <- cbind(corpus.p.list, topicProbabilities[(n.corpuss2+1):n.totalrow,])
topic.pres <- matrix(NA, nrow = length(Years.compare), ncol = 12)
colnames(topic.pres) <- names(topicProbabilities)
r.name <- vector(length = length(Years.compare))
for (i in 1:length(Years.compare)){
## Find the topics of the inaugspeech of presidents
KEY1 <- findpresident(Years.compare[i])
corpuss.temp <- tbl_df(corpuss.s.topic) %>%
filter(File == (KEY1$File), type=="inaug") %>%
select(25:36)
corpuss.df1 <- as.data.frame(corpuss.temp)
corpuss.df1m <- colMeans(corpuss.df1)
## Find that platform text
corpuss.p.temp <-  tbl_df(corpuss.p.topic) %>%
filter(Year == Years.compare[i], Party == KEY1$Party) %>%
select(18:29)
corpuss.df2 <- as.data.frame(corpuss.p.temp)
corpuss.df2m <- colMeans(corpuss.df2)
topic.pres[i,] <- corpuss.df2m - corpuss.df1m # Party - President
r.name[i] <- paste0(KEY1$President,Years.compare[i] )
}
rownames(topic.pres) <- r.name
# Draw a non-scaled figure
heatmap.2(topic.pres,
scale = "none",
col = bluered(100), key=T, keysize = 2,
cexRow = 0.5, cexCol = 0.5,
trace = "none", density.info = "density")
# Draw a column-scaled figure
heatmap.2(topic.pres,
scale = "colum", key=T,keysize = 2,
col = bluered(100),
cexRow = 0.5, cexCol = 0.5,
trace = "none", density.info = "density")
## To see the name clearly, I remove the presidents' name, only leaving the year
rr.name <- substr(r.name, nchar(r.name)-3,nchar(r.name))
topicc.pres <- topic.pres
rownames(topicc.pres) <- rr.name
km.res=kmeans(topicc.pres, iter.max=200,5)
fviz_cluster(km.res,
stand=F, repel= TRUE,
data = topicc.pres, xlab="", xaxt=1,
show.clust.cent=FALSE)
## Before Scaling
score.before <- rowSums(abs(topic.pres))
order.score.b <- order(score.before)
#  rownames(topic.pres)[order.score.b]
cat(names(which.min(score.before)), "said very similar things in this inauguration.\n")
cat(names(which.max(score.before)),"almost ignored his party.")
## Before Scaling
score.before <- rowSums(abs(topic.pres))
order.score.b <- order(score.before)
#  rownames(topic.pres)[order.score.b]
cat(names(which.min(score.before)), "said very similar things in this inauguration.\n")
cat(names(which.max(score.before)),"almost ignored his party.")
inaug.list=read.csv("../data/inauglist.csv", stringsAsFactors = FALSE)
nomin.list=read.csv("../data/nominlist.csv", stringsAsFactors = FALSE)
farewell.list=read.csv("../data/farewelllist.csv", stringsAsFactors = FALSE)
setwd("~/Desktop/ADS/GITHUB/Spr2017-Proj1-KaiChenColumbia/doc")
inaug.list=read.csv("../data/inauglist.csv", stringsAsFactors = FALSE)
nomin.list=read.csv("../data/nominlist.csv", stringsAsFactors = FALSE)
farewell.list=read.csv("../data/farewelllist.csv", stringsAsFactors = FALSE)
corpuss.df2
corpuss.s.topic
names(corpuss.s.topic)
corpuss.sent <- tbl_df(corpuss.s.topic) %>%
filter(File == (KEY1$File), type=="farewell") %>%
select(13:20)
corpuss.df1 <- as.data.frame(corpuss.sent)
corpuss.sent.df <- as.data.frame(corpuss.sent)
head(corpuss.sent.df)
corpuss.sent <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.df <- as.data.frame(corpuss.sent)
corpuss.sent.df
corpuss.sent.fwl <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.fwl <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.fwl <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.fwl.df <- as.data.frame(corpuss.sent.fwl)
corpuss.sent.result <- colMeans(corpuss.sent.fwl.df)
corpuss.p.result
corpuss.s.result
corpuss.sent.result
# Overall
corpuss.sent.ina <- tbl_df(corpuss.s.topic) %>%
filter(type=="inaug") %>%
select(13:20)
corpuss.sent.ina.df <- as.data.frame(corpuss.sent.ina)
corpuss.sent.result <- colMeans(corpuss.sent.ina.df)
corpuss.sent.fwl <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.fwl.df <- as.data.frame(corpuss.sent.fwl)
corpuss.sent.result <- colMeans(corpuss.sent.fwl.df)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- as.data.frame(temp.tbl)
corpuss.sent.ina <- tbl_df(corpuss.s.topic) %>%
filter(type=="inaug") %>%
select(13:20)
corpuss.sent.ina.df <- as.data.frame(corpuss.sent.ina)
corpuss.sent.result.ina <- colMeans(corpuss.sent.ina.df)
corpuss.sent.fwl <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.fwl.df <- as.data.frame(corpuss.sent.fwl)
corpuss.sent.result.fwl <- colMeans(corpuss.sent.fwl.df)
temp.df <- as.data.frame(temp.tbl)
temp.df <- cbind(Group = factor(c("Farewell","Inauguration")),
Farewell <-  corpuss.sent.result.fwl,
Inaug <- corpuss.sent.result.ina)
ggradar(temp.df, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
ggradar(temp.df, grid.max = 0.1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
names(corpuss.sent.result.ina)
temp.df <- cbind(Group = factor(c("Farewell","Inaug")),
Farewell <-  corpuss.sent.result.fwl,
Inaug <- corpuss.sent.result.ina)
rownames(temp.df) = 1:4
temp.df <- cbind(Group = factor(c("Farewell","Inaug")),
Farewell <-  corpuss.sent.result.fwl,
Inaug <- corpuss.sent.result.ina)
ggradar(temp.df, grid.max = 0.1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
corpuss.sent.fwl <- tbl_df(corpuss.s.topic) %>%
filter(type=="farewell") %>%
select(13:20)
corpuss.sent.fwl.df <- as.data.frame(corpuss.sent.fwl)
corpuss.sent.result.fwl <- colMeans(corpuss.sent.fwl.df)
temp.df <- cbind(Group = factor(c("Farewell","Inaug")),
Farewell <-  corpuss.sent.result.fwl,
Inaug <- corpuss.sent.result.ina)
rnow(temp.df) <- c("anger", "anticipation", "disgust","fear","joy","sadness"
,"surprise" , "trust"    )
temppp.tbl <- tbl_df(sentence.p.list) %>%
filter(Year == "1856", Party=="Republican")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df <- rbind(temp.df,temp.df)
temp.df <- rbind(temp.df,temp.df)*10
temp.df <- cbind(Group = factor(c("g1","g2","g3","g4")), temp.df)
rownames(temp.df) = 1:4
ggradar(temp.df, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
temppp.tbl <- tbl_df(sentence.p.list) %>%
filter(Year == "1856", Party=="Republican")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df <- rbind(temp.df,temp.df)
temp.df <- rbind(temp.df,temp.df)*10
temp.df <- cbind(Group = factor(c("g1","g2","g3","g4")), temp.df)
rownames(temp.df) = c(1,2,3,6)
ggradar(temp.df, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
temppp.tbl <- tbl_df(sentence.p.list) %>%
filter(Year == "1856", Party=="Republican")%>%
select(anger:trust)
temppp.tbl <- tbl_df(sentence.p.list) %>%
filter(Year == "1856", Party=="Republican")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df
temp.df <- colMeans(temp.df)
temp.df
temp.df <- rbind(temp.df,temp.df)*10
temp.df <- cbind(Group = factor(c("g1","g2","g3","g4")), temp.df)
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temp.df <- cbind(
Farewell <-  corpuss.sent.result.fwl,
Inaug <- corpuss.sent.result.ina)
rnow(temp.df) <- c("anger", "anticipation", "disgust","fear","joy","sadness"
,"surprise" , "trust"    )
temp.df
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "Farewell")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "farewell")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl.i <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "farewell")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl.i <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df.i <- as.data.frame(temppp.tbl.i)
temp.df.i <- colMeans(temp.df.i)
temp.df.i
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "farewell")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl.i <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df.i <- as.data.frame(temppp.tbl.i)
temp.df.i <- colMeans(temp.df.i)
temp.df.i
temp.df.x <- rbind(temp.df,temp.df.i)
temp.df.x <- cbind(Group = factor(c("farewell","inaug")), temp.df.x)
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
temp.df.x <- rbind(temp.df,temp.df.i)
temp.df.x <- cbind(Group = factor(c("farewell","inaug")), temp.df.x)
rownames(temp.df) = c("farewell","inaug")
rownames(temp.df) = c("farewell","inaug")
temp.df.x <- rbind(temp.df,temp.df.i)
temp.df.x <- cbind(Group = factor(c("farewell","inaug")), temp.df.x)
temp.df.x <- rbind(temp.df,temp.df.i)
temp.df.x <- cbind(Group = factor(c("farewell","inaug")), temp.df.x)
rownames(temp.df.x) = c("farewell","inaug")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
temppp.tbl <- tbl_df(sentence.s.list) %>%
filter(type == "farewell")%>%
select(anger:trust)
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl.i <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df.i <- as.data.frame(temppp.tbl.i)
temp.df.i <- colMeans(temp.df.i)
temp.df.i
temp.df.x <- rbind(temp.df,temp.df.i) *10
temp.df.x <- cbind(Group = factor(c("farewell","inaug")), temp.df.x)
rownames(temp.df.x) = c("farewell","inaug")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1.5,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.05,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash",
legend.title = c("farewell","inaug"))
temp.df <- as.data.frame(temppp.tbl)
temp.df <- colMeans(temp.df)
temp.df
temppp.tbl.i <- tbl_df(sentence.s.list) %>%
filter(type == "inaug")%>%
select(anger:trust)
temp.df.i <- colMeans(temp.df.i)
temp.df.i
temp.df.x <- rbind(temp.df,temp.df.i) *10
temp.df.x <- cbind(Group = factor(c("farewell","inaug")), temp.df.x)
rownames(temp.df.x) = c("farewell","inaug")
ggradar(temp.df.x, grid.max = 1,
background.circle.colour = "#ffdd99",
background.circle.transparency = 0.5,
group.line.width = 1,
group.point.size = 3,
axis.label.size = 2,
gridline.min.colour = "#4b61ba",
gridline.mid.colour = "#a87963",
gridline.max.colour = "#e1e6ea",
grid.line.width = 1,
gridline.min.linetype = "longdash",
gridline.mid.linetype = "longdash",
gridline.max.linetype = "longdash",
legend.title = c("farewell","inaug"))
